<!DOCTYPE html>
<html>
  <head>
    <link rel=stylesheet href="/css/reset.css">
    <link rel=stylesheet href="/css/synseer/main.css">
    <script src="/js/synseer.js"></script>
  </head>
<body>

<div class="total_score stats">
  <div class="games_completed"> <%= scores.total_completed %> </div>
  <div class="correct">         <%= scores.total_correct   %> </div>
  <div class="incorrect">       <%= scores.total_incorrect %> </div>
  <div class="time">            <%= sprintf '%01d:%02d', scores.total_duration/60, scores.total_duration%60 %></div>
</div>

<ul class="available_games">
  <% games.each do |_path, game| %>
    <li class="game">
      <a class="name" href="<%= game.fetch(:path) %>">
        <%= game.fetch(:name) %>
      </a>
      <div class="score" data-id="<%= game.fetch(:id) %>">
         <div class="correct"></div>
         <div class="incorrect"></div>
         <div class="time"></div>
      </div>
    </div>
  <% end %>
  <script>
    'use strict';
    var Synseer = require('synseer');
    // init/load the data from localstorage
    var appState = {games: []};
    if(localStorage.appState === undefined)
      localStorage.appState = JSON.stringify(appState);
    else
      appState = JSON.parse(localStorage.appState);

    var forEach = Array.prototype.forEach;
    var scores  = document.querySelectorAll('li.game .score');
    forEach.call(scores, function(domScore) {
      // find the current game
      var view = new Synseer.StatsView(domScore);
      var game = undefined;
      for(var i=0; i<appState.games.length; ++i) {
        if(appState.games[i].id === domScore.dataset["id"]) {
          game = appState.games[i];
          break;
        }
      }
      if(game) {
        view.setNumCorrect(game.numCorrect);
        view.setNumIncorrect(game.numIncorrect);
        view.setDuration(game.duration);
      } else {
        view.setNumCorrect(0);
        view.setNumIncorrect(0);
        view.setDuration(0);
      }
    })
  </script>
</div>
</body>
</html>
