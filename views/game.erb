<!DOCTYPE html>
<html>
<head>
   <link rel=stylesheet href="/codemirror/lib/codemirror.css">
   <link rel=stylesheet href="/codemirror/theme/solarized.css">

   <script src="/codemirror/lib/codemirror.js"></script>
   <script src="/codemirror/mode/ruby/ruby.js"></script>
   <script src="/js/jquery.js"></script>
   <script src="/js/synseer.js"></script>



   <style>
     body, html, .content, .CodeMirror {
       margin:  0;
       padding: 0;
       width:  100%;
       height: 100%;
     }

     .currentElement {
       background-color: #00495b; /* solarized dark (#002b36) times 1.7 */
     }

     .CodeMirror {
       padding-top: 1em;
     }
   </style>
</head>

<body>
  <div class="content">
    <div class="stats">
      <div class="time"></div>
      <div class="correct"></div>
      <div class="incorrect"></div>
    </div>
    <textarea class="code"><%= @game.fetch(:body) %></textarea>
  </div>

  <script>
    window.game = (function() {
      'use strict';
      var Synseer = require('synseer');

      var game = new Synseer.Game({
        codeMirror: CodeMirror.fromTextArea(
                      document.getElementsByTagName('textarea')[0],
                      {lineNumbers: true, theme: 'solarized dark', autofocus: true}
                    ),
        statsView:  new Synseer.StatsView(document.getElementsByClassName('stats')[0]),
        ast:        <%= @game.fetch :json_ast %>,
        keyMap:     Synseer.DefaultKeymap,
        onFinished: function() {
                      // currently this summary does nothing interesting
                      var domFinished = document.createElement("div");
                      domFinished.classList.add("summary");
                      var node = document.createTextNode("This is new.");
                      domFinished.appendChild(node);
                      document.getElementsByTagName('body')[0].appendChild(domFinished);

                      // TODO: This is the only dependency on jQuery
                      jQuery.post(window.location.pathname, {"game": game._statsView.data() });
                    }
      });

      game.init();
      return game;
    })();

    game.start(function() { return new Date() }, setInterval);
  </script>
</div>
</body>
</html>
